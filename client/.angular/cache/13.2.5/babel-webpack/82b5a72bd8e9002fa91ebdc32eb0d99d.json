{"ast":null,"code":"import { HttpEventType } from '@angular/common/http';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"../admin.service\";\nimport * as i2 from \"ngx-toastr\";\nimport * as i3 from \"@angular/common\";\nimport * as i4 from \"../../shared/components/photo-widget/photo-widget.component\";\n\nfunction EditProductPhotosComponent_ng_container_2_div_7_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r5 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementStart(0, \"div\", 7)(1, \"div\", 8);\n    i0.ɵɵelement(2, \"img\", 9);\n    i0.ɵɵelementStart(3, \"div\", 10)(4, \"button\", 11);\n    i0.ɵɵlistener(\"click\", function EditProductPhotosComponent_ng_container_2_div_7_Template_button_click_4_listener() {\n      const restoredCtx = i0.ɵɵrestoreView(_r5);\n      const photo_r3 = restoredCtx.$implicit;\n      const ctx_r4 = i0.ɵɵnextContext(2);\n      return ctx_r4.setMainPhoto(photo_r3.id);\n    });\n    i0.ɵɵtext(5, \"Set Main \");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(6, \"button\", 12);\n    i0.ɵɵlistener(\"click\", function EditProductPhotosComponent_ng_container_2_div_7_Template_button_click_6_listener() {\n      const restoredCtx = i0.ɵɵrestoreView(_r5);\n      const photo_r3 = restoredCtx.$implicit;\n      const ctx_r6 = i0.ɵɵnextContext(2);\n      return ctx_r6.deletePhoto(photo_r3.id);\n    });\n    i0.ɵɵelement(7, \"i\", 13);\n    i0.ɵɵelementEnd()()()();\n  }\n\n  if (rf & 2) {\n    const photo_r3 = ctx.$implicit;\n    i0.ɵɵadvance(2);\n    i0.ɵɵpropertyInterpolate(\"src\", photo_r3.pictureUrl, i0.ɵɵsanitizeUrl);\n    i0.ɵɵpropertyInterpolate(\"alt\", photo_r3.fileName);\n    i0.ɵɵadvance(2);\n    i0.ɵɵclassMap(photo_r3.isMain ? \"btn btn-success\" : \"btn btn-outline-success\");\n    i0.ɵɵproperty(\"disabled\", photo_r3.isMain);\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"disabled\", photo_r3.isMain);\n  }\n}\n\nfunction EditProductPhotosComponent_ng_container_2_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r8 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementContainerStart(0);\n    i0.ɵɵelementStart(1, \"div\", 3)(2, \"h3\");\n    i0.ɵɵtext(3, \"Product Photos\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(4, \"button\", 4);\n    i0.ɵɵlistener(\"click\", function EditProductPhotosComponent_ng_container_2_Template_button_click_4_listener() {\n      i0.ɵɵrestoreView(_r8);\n      const ctx_r7 = i0.ɵɵnextContext();\n      return ctx_r7.addPhotoModeToggle();\n    });\n    i0.ɵɵtext(5, \" Add New Photo \");\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(6, \"div\", 5);\n    i0.ɵɵtemplate(7, EditProductPhotosComponent_ng_container_2_div_7_Template, 8, 7, \"div\", 6);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementContainerEnd();\n  }\n\n  if (rf & 2) {\n    const ctx_r0 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(7);\n    i0.ɵɵproperty(\"ngForOf\", ctx_r0.product == null ? null : ctx_r0.product.photos);\n  }\n}\n\nfunction EditProductPhotosComponent_ng_container_3_div_6_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 17)(1, \"div\", 18);\n    i0.ɵɵtext(2);\n    i0.ɵɵelementEnd()();\n  }\n\n  if (rf & 2) {\n    const ctx_r9 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance(1);\n    i0.ɵɵstyleProp(\"width\", ctx_r9.progress, \"%\");\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate1(\" \", ctx_r9.progress, \"% \");\n  }\n}\n\nfunction EditProductPhotosComponent_ng_container_3_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r11 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementContainerStart(0);\n    i0.ɵɵelementStart(1, \"div\", 3)(2, \"h3\");\n    i0.ɵɵtext(3, \"Add new product image\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(4, \"button\", 14);\n    i0.ɵɵlistener(\"click\", function EditProductPhotosComponent_ng_container_3_Template_button_click_4_listener() {\n      i0.ɵɵrestoreView(_r11);\n      const ctx_r10 = i0.ɵɵnextContext();\n      return ctx_r10.ngOnInit();\n    });\n    i0.ɵɵtext(5, \"Cancel\");\n    i0.ɵɵelementEnd()();\n    i0.ɵɵtemplate(6, EditProductPhotosComponent_ng_container_3_div_6_Template, 3, 3, \"div\", 15);\n    i0.ɵɵelementStart(7, \"app-photo-widget\", 16);\n    i0.ɵɵlistener(\"addFile\", function EditProductPhotosComponent_ng_container_3_Template_app_photo_widget_addFile_7_listener($event) {\n      i0.ɵɵrestoreView(_r11);\n      const ctx_r12 = i0.ɵɵnextContext();\n      return ctx_r12.uploadFile($event);\n    });\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementContainerEnd();\n  }\n\n  if (rf & 2) {\n    const ctx_r1 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(6);\n    i0.ɵɵproperty(\"ngIf\", ctx_r1.progress > 0);\n  }\n}\n\nexport let EditProductPhotosComponent = /*#__PURE__*/(() => {\n  class EditProductPhotosComponent {\n    constructor(adminService, toast) {\n      this.adminService = adminService;\n      this.toast = toast;\n      this.progress = 0;\n      this.addPhotoMode = false;\n    }\n\n    ngOnInit() {}\n\n    uploadFile(file) {\n      this.adminService.uploadImage(file, this.product.id).subscribe(event => {\n        switch (event.type) {\n          case HttpEventType.UploadProgress:\n            this.progress = Math.round(event.loaded / event.total * 100);\n            break;\n\n          case HttpEventType.Response:\n            this.product = event.body;\n            setTimeout(() => {\n              this.progress = 0;\n              this.addPhotoMode = false;\n            }, 1500);\n        }\n      }, error => {\n        if (error.errors) {\n          this.toast.error(error.errors[0]);\n        } else {\n          this.toast.error('Problem uploading image');\n        }\n\n        this.progress = 0;\n      });\n    }\n\n    deletePhoto(photoId) {\n      this.adminService.deleteProductPhoto(photoId, this.product.id).subscribe(() => {\n        const photoIndex = this.product.photos.findIndex(x => x.id === photoId);\n        this.product.photos.splice(photoIndex, 1);\n      }, error => {\n        this.toast.error('Problem deleting photo');\n        console.log(error);\n      });\n    }\n\n    setMainPhoto(photoId) {\n      this.adminService.setMainPhoto(photoId, this.product.id).subscribe(product => {\n        this.product = product;\n      });\n    }\n\n  }\n\n  EditProductPhotosComponent.ɵfac = function EditProductPhotosComponent_Factory(t) {\n    return new (t || EditProductPhotosComponent)(i0.ɵɵdirectiveInject(i1.AdminService), i0.ɵɵdirectiveInject(i2.ToastrService));\n  };\n\n  EditProductPhotosComponent.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n    type: EditProductPhotosComponent,\n    selectors: [[\"app-edit-product-photos\"]],\n    inputs: {\n      product: \"product\"\n    },\n    decls: 4,\n    vars: 2,\n    consts: [[1, \"py-5\"], [1, \"container\"], [4, \"ngIf\"], [1, \"d-flex\", \"justify-content-between\", \"mb-3\"], [1, \"btn\", \"btn-primary\", 3, \"click\"], [1, \"row\"], [\"class\", \"col-3\", 4, \"ngFor\", \"ngForOf\"], [1, \"col-3\"], [1, \"card\"], [\"width\", \"100%\", \"height\", \"225\", 1, \"card-img-top\", 3, \"src\", \"alt\"], [1, \"btn-group\", 2, \"width\", \"100%\"], [\"type\", \"button\", 2, \"width\", \"50%\", 3, \"disabled\", \"click\"], [\"type\", \"button\", 1, \"btn\", \"btn-outline-danger\", 2, \"width\", \"50%\", 3, \"disabled\", \"click\"], [1, \"fa\", \"fa-trash\"], [1, \"btn\", \"btn-outline-secondary\", 3, \"click\"], [\"class\", \"progress form-group\", 4, \"ngIf\"], [3, \"addFile\"], [1, \"progress\", \"form-group\"], [\"role\", \"progressbar\", 1, \"progress-bar\", \"progress-bar-striped\", \"bg-success\"]],\n    template: function EditProductPhotosComponent_Template(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵelementStart(0, \"div\", 0)(1, \"div\", 1);\n        i0.ɵɵtemplate(2, EditProductPhotosComponent_ng_container_2_Template, 8, 1, \"ng-container\", 2);\n        i0.ɵɵtemplate(3, EditProductPhotosComponent_ng_container_3_Template, 8, 1, \"ng-container\", 2);\n        i0.ɵɵelementEnd()();\n      }\n\n      if (rf & 2) {\n        i0.ɵɵadvance(2);\n        i0.ɵɵproperty(\"ngIf\", !ctx.addPhotoMode);\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"ngIf\", ctx.addPhotoMode);\n      }\n    },\n    directives: [i3.NgIf, i3.NgForOf, i4.PhotoWidgetComponent],\n    styles: [\"\"]\n  });\n  return EditProductPhotosComponent;\n})();","map":null,"metadata":{},"sourceType":"module"}